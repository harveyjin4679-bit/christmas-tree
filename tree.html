<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>蓝色雪夜圣诞树给小妍</title>
<style>
    body { margin: 0; overflow: hidden; background: black; }
    #message {
        position: absolute;
        bottom: 30px;
        width: 100%;
        text-align: center;
        font-size: 2em;
        font-family: 'Courier New', monospace;
        animation: glow 1s infinite alternate;
    }
    @keyframes glow {
        from { color: red; text-shadow: 0 0 10px red; }
        to { color: yellow; text-shadow: 0 0 30px yellow; }
    }
</style>
</head>
<body>
<div id="message">To 小妍</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
// 场景：背景统一蓝色
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x003366); // 深蓝色

// 摄像机、渲染器
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.set(0, 5, 20);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 灯光
scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const spotLight = new THREE.SpotLight(0xffffff, 1);
spotLight.position.set(15, 20, 10);
scene.add(spotLight);

// 圣诞树
function createPrettyTree() {
    const treeGroup = new THREE.Group();
    let layerCount = 8;
    let yOffset = -3;
    for (let i = 0; i < layerCount; i++) {
        let greenShade = 0x0a8a0a + i*1000;
        const layer = new THREE.Mesh(
            new THREE.ConeGeometry(5 - i*0.5, 2, 32),
            new THREE.MeshLambertMaterial({ color: greenShade })
        );
        layer.position.y = yOffset;
        treeGroup.add(layer);
        yOffset += 1.8;
    }
    // 树干
    const trunk = new THREE.Mesh(
        new THREE.CylinderGeometry(0.8, 1, 3, 16),
        new THREE.MeshLambertMaterial({ color: 0x8B4513 })
    );
    trunk.position.y = -5;
    treeGroup.add(trunk);

    // 顶部五角星
    const starShape = new THREE.Shape();
    const spikes = 5, outerRadius = 1.2, innerRadius = 0.5;
    for (let i = 0; i < spikes * 2; i++) {
        const angle = i * Math.PI / spikes;
        const radius = (i % 2 === 0) ? outerRadius : innerRadius;
        starShape.lineTo(Math.cos(angle) * radius, Math.sin(angle) * radius);
    }
    const starGeom = new THREE.ExtrudeGeometry(starShape, { depth: 0.3, bevelEnabled: false });
    const starMat = new THREE.MeshBasicMaterial({ color: 0xffff00 });
    const star = new THREE.Mesh(starGeom, starMat);
    star.position.set(0, yOffset + 0.5, 0);
    star.rotation.x = Math.PI / 2;
    treeGroup.add(star);

    // 彩灯
    const bulbColors = [0xff0000, 0xffff00, 0x00ffff, 0xff00ff, 0x00ff00];
    for (let i = 0; i < 50; i++) {
        const bulb = new THREE.Mesh(
            new THREE.SphereGeometry(0.1, 8, 8),
            new THREE.MeshBasicMaterial({ color: bulbColors[Math.floor(Math.random()*bulbColors.length)] })
        );
        bulb.position.set(
            (Math.random() - 0.5) * 6,
            -3 + Math.random() * 10,
            (Math.random() - 0.5) * 6
        );
        treeGroup.add(bulb);
    }
    return treeGroup;
}
const tree = createPrettyTree();
scene.add(tree);

// 雪花粒子
function createSnow(count, size) {
    const geo = new THREE.BufferGeometry();
    const pos = [];
    for (let i = 0; i < count; i++) {
        pos.push((Math.random() * 80 - 40));
        pos.push((Math.random() * 50 - 5));
        pos.push((Math.random() * 80 - 40));
    }
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
    const mat = new THREE.PointsMaterial({ color: 0xffffff, size: size });
    const points = new THREE.Points(geo, mat);
    return {points, geo};
}
const snow = createSnow(500, 0.15);
scene.add(snow.points);

// 动画
function animate() {
    requestAnimationFrame(animate);
    // 树旋转
    tree.rotation.y += 0.003;
    // 彩灯闪烁
    tree.children.forEach(obj => {
        if (obj.geometry.type === 'SphereGeometry') {
            obj.material.color.setHex(Math.random()*0xffffff);
        }
    });
    // 雪花下落
    const pos = snow.geo.attributes.position;
    for (let i = 0; i < pos.count; i++) {
        let y = pos.getY(i);
        y -= 0.05;
        if (y < -10) y = 30;
        pos.setY(i, y);
    }
    pos.needsUpdate = true;
    renderer.render(scene, camera);
}
animate();

// 背景音乐
const audio = new Audio("https://cdn.pixabay.com/download/audio/2022/07/26/audio_2e5b12e9fd.mp3?filename=we-wish-you-a-merry-christmas-13185.mp3");
audio.loop = true;
audio.play();

// 响应式调整
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>